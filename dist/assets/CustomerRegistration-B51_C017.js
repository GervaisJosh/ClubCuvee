import{u as q,a as E,r as i,j as e,C as u,A as F,B as h,d as A,h as I,e as R,k as U,f as z}from"./index-C48oJ7rO.js";const B=()=>{const{token:m}=q(),w=E(),[o,C]=i.useState(null),[k,b]=i.useState(!0),[c,l]=i.useState(null),[g,y]=i.useState("select-tier"),[j,N]=i.useState(!1),[d,S]=i.useState(""),[t,v]=i.useState({name:"",email:"",phone:"",address:"",city:"",state:"",zip_code:"",wine_preferences:"",dietary_restrictions:"",special_requests:"",selected_tier_id:""});i.useEffect(()=>{(async()=>{if(!m){l("No invitation token provided"),b(!1);return}try{const a=await fetch("/api/validate-customer-invitation",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:m})});if(!a.ok)throw new Error("Invalid or expired invitation");const r=await a.json();C(r)}catch(a){l(a instanceof Error?a.message:"Failed to load invitation data")}finally{b(!1)}})()},[m]);const n=s=>{const{name:a,value:r}=s.target;v(x=>({...x,[a]:r}))},_=s=>{S(s),v(a=>({...a,selected_tier_id:s}))},P=()=>{if(!d){l("Please select a membership tier");return}l(null),y("fill-form")},T=async s=>{s.preventDefault();const a=["name","email","address","city","state","zip_code"];for(const r of a)if(!t[r]){l(`Please fill in the ${r.replace("_"," ")} field`);return}try{N(!0),l(null);const r=await fetch("/api/create-customer-checkout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:m,customerData:t})});if(!r.ok)throw new Error("Failed to create checkout session");const x=await r.json();if(x.checkoutUrl)window.location.href=x.checkoutUrl;else throw new Error("No checkout URL received")}catch(r){l(r instanceof Error?r.message:"Failed to process registration"),N(!1)}};if(k)return e.jsx("div",{className:"min-h-screen bg-[#fdfaf7] px-6 py-10 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#800020] mx-auto mb-4"}),e.jsx("p",{className:"text-lg text-gray-600",children:"Loading invitation details..."})]})});if(c&&!o)return e.jsx("div",{className:"min-h-screen bg-[#fdfaf7] px-6 py-10 flex items-center justify-center",children:e.jsxs(u,{className:"max-w-md mx-auto p-8 text-center",children:[e.jsx(F,{className:"h-16 w-16 text-red-500 mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Invalid Invitation"}),e.jsx("p",{className:"text-gray-600 mb-6",children:c}),e.jsx(h,{onClick:()=>w("/"),variant:"secondary",className:"w-full",children:"Return Home"})]})});if(!o)return null;const f=o.membershipTiers.find(s=>s.id===d),D=new Date(o.invitation.expires_at).getTime()-Date.now(),p=Math.floor(D/(1e3*60*60));return j?e.jsx("div",{className:"min-h-screen bg-[#fdfaf7] px-6 py-10 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[#800020] mx-auto mb-4"}),e.jsx("p",{className:"text-lg text-gray-600",children:"Creating your checkout session..."})]})}):e.jsx("div",{className:"min-h-screen bg-[#fdfaf7] px-6 py-10",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsxs("h1",{className:"text-4xl font-bold text-gray-900 mb-4",children:["Join ",o.business.name,"'s Wine Club"]}),e.jsx("p",{className:"text-xl text-gray-600 mb-2",children:"Discover curated wines delivered to your door"})]}),p<48&&p>0&&e.jsx(u,{className:"p-4 mb-6 bg-yellow-50 border-yellow-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(A,{className:"h-5 w-5 text-yellow-500 mr-2"}),e.jsxs("p",{className:"text-sm text-yellow-700",children:["This invitation expires in ",p," hours. Complete your registration soon!"]})]})}),g==="select-tier"&&e.jsxs(u,{className:"p-8 mb-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6 text-center",children:"Choose Your Membership"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:o.membershipTiers.map(s=>e.jsx("div",{className:`p-6 border-2 rounded-lg cursor-pointer transition-all ${d===s.id?"border-[#800020] bg-[#800020]/5":"border-gray-200 hover:border-[#800020]/30"}`,onClick:()=>_(s.id),children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"h-12 w-12 bg-[#800020] rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(I,{className:"h-6 w-6 text-white"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:s.name}),e.jsxs("p",{className:"text-2xl font-bold text-[#800020] mb-2",children:["$",parseFloat(s.price).toFixed(2),"/month"]}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:s.description}),d===s.id&&e.jsxs("div",{className:"flex items-center justify-center space-x-2 text-[#800020]",children:[e.jsx(R,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Selected"})]})]})},s.id))}),c&&e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg mb-4",children:e.jsx("p",{className:"text-sm text-red-600",children:c})}),e.jsx("div",{className:"text-center",children:e.jsxs(h,{onClick:P,disabled:!d,children:["Continue to Registration",e.jsx(U,{className:"w-4 h-4 ml-2"})]})})]}),g==="fill-form"&&f&&e.jsxs(u,{className:"p-8 mb-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Complete Your Registration"}),e.jsxs("p",{className:"text-gray-600",children:["Selected: ",e.jsx("span",{className:"font-medium text-[#800020]",children:f.name})," - $",parseFloat(f.price).toFixed(2),"/month"]})]}),e.jsxs("form",{onSubmit:T,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Personal Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Full Name *"}),e.jsx("input",{type:"text",name:"name",value:t.name,onChange:n,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#800020]",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address *"}),e.jsx("input",{type:"email",name:"email",value:t.email,onChange:n,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#800020]",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone Number"}),e.jsx("input",{type:"tel",name:"phone",value:t.phone,onChange:n,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#800020]"})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Delivery Address"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Street Address *"}),e.jsx("input",{type:"text",name:"address",value:t.address,onChange:n,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#800020]",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"City *"}),e.jsx("input",{type:"text",name:"city",value:t.city,onChange:n,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#800020]",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"State *"}),e.jsx("input",{type:"text",name:"state",value:t.state,onChange:n,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#800020]",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ZIP Code *"}),e.jsx("input",{type:"text",name:"zip_code",value:t.zip_code,onChange:n,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#800020]",required:!0})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Wine Preferences"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Wine Preferences"}),e.jsx("textarea",{name:"wine_preferences",value:t.wine_preferences,onChange:n,rows:3,placeholder:"Tell us about your wine preferences (e.g., red wines, specific regions, flavor profiles)",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#800020]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Dietary Restrictions"}),e.jsx("input",{type:"text",name:"dietary_restrictions",value:t.dietary_restrictions,onChange:n,placeholder:"Any allergies or dietary restrictions?",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#800020]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Special Requests"}),e.jsx("textarea",{name:"special_requests",value:t.special_requests,onChange:n,rows:2,placeholder:"Any special requests or notes for your wine selections?",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#800020]"})]})]})]}),c&&e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-red-600",children:c})}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx(h,{type:"button",variant:"secondary",onClick:()=>y("select-tier"),className:"flex-1",children:"Back to Tier Selection"}),e.jsxs(h,{type:"submit",className:"flex-1",disabled:j,children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Proceed to Payment"]})]})]})]})]})})};export{B as default};
//# sourceMappingURL=CustomerRegistration-B51_C017.js.map
