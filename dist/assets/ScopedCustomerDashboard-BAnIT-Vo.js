import{l as C,r as n,s as S,j as e,C as l,W as u,B as t,m as E,G as D,U as A,n as k,S as M,f as U}from"./index-CiaQwhO3.js";const W=()=>{const{user:r,signOut:b}=C(),[a,j]=n.useState(null),[i,p]=n.useState(null),[c,N]=n.useState(null),[f,m]=n.useState(!0),[d,o]=n.useState(null);n.useEffect(()=>{r&&g()},[r]);const g=async()=>{try{m(!0),o(null);const{data:s,error:h}=await S.from("customers").select(`
          id,
          business_id,
          subscription_status,
          tier_id,
          stripe_subscription_id,
          created_at,
          businesses!inner(id, name, email),
          membership_tiers(id, name, description)
        `).eq("auth_id",r.id).single();if(h)throw new Error("Could not load customer membership: "+h.message);if(!s)throw new Error("Customer membership not found. You may not have access to any business.");const w={id:r.id,businessId:s.business_id,businessName:s.businesses.name,email:r.email||"",firstName:r?.user_metadata?.first_name||null,lastName:r?.user_metadata?.last_name||null,phone:r?.user_metadata?.phone||null};j(w),N({id:s.businesses.id,name:s.businesses.name,email:s.businesses.email});const _={id:s.id,tierId:s.tier_id||"",tierName:s.membership_tiers?.name||"Unknown Tier",tierDescription:s.membership_tiers?.description||"",status:s.status||"inactive",stripeSubscriptionId:s.stripe_subscription_id||"",createdAt:s.created_at};p(_)}catch(s){console.error("Error loading customer data:",s),o(s.message||"Failed to load customer data")}finally{m(!1)}},x=async()=>{try{await b()}catch(s){console.error("Error signing out:",s)}},y=s=>{switch(s){case"active":return"text-green-600 bg-green-50 border-green-200";case"past_due":return"text-yellow-600 bg-yellow-50 border-yellow-200";case"canceled":return"text-red-600 bg-red-50 border-red-200";default:return"text-gray-600 bg-gray-50 border-gray-200"}},v=s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});return f?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-[#fdfaf7] px-6 py-10",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"h-12 w-12 animate-spin border-4 border-[#800020] border-t-transparent rounded-full mx-auto mb-6"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"Loading your membership..."})]})}):d||!a?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-[#fdfaf7] px-6 py-10",children:e.jsxs(l,{className:"max-w-md mx-auto p-8 text-center",children:[e.jsx(u,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Access Error"}),e.jsx("p",{className:"text-gray-600 mb-6",children:d||"Unable to access your membership. You may not have permission to view this content."}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(t,{onClick:x,variant:"secondary",className:"w-full",children:"Sign Out"}),e.jsx(t,{onClick:()=>window.location.reload(),className:"w-full",children:"Try Again"})]})]})}):e.jsxs("div",{className:"min-h-screen bg-[#fdfaf7]",children:[e.jsx("div",{className:"bg-gradient-to-br from-[#800020] to-[#600018] text-white py-8 px-6",children:e.jsx("div",{className:"max-w-6xl mx-auto",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold mb-2",children:["Welcome back, ",a.firstName||"Member","!"]}),e.jsxs("p",{className:"text-white/90 flex items-center",children:[e.jsx(E,{className:"w-4 h-4 mr-2"}),a.businessName," Wine Club"]})]}),e.jsx(t,{onClick:x,variant:"secondary",size:"sm",children:"Sign Out"})]})})}),e.jsx("div",{className:"py-8 px-6",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8",children:[e.jsxs(l,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Your Membership"}),e.jsx(u,{className:"h-6 w-6 text-[#800020]"})]}),i?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:i.tierName}),e.jsx("p",{className:"text-gray-600",children:i.tierDescription})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Status:"}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${y(i.status)}`,children:i.status})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Member since:"}),e.jsx("span",{className:"text-sm text-gray-900",children:v(i.createdAt)})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(D,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"No Active Membership"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"You don't have an active membership yet."}),e.jsxs(t,{size:"sm",children:["Contact ",a.businessName]})]})]}),e.jsxs(l,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Account Information"}),e.jsx(A,{className:"h-6 w-6 text-[#800020]"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Name:"}),e.jsx("p",{className:"text-gray-900",children:a.firstName&&a.lastName?`${a.firstName} ${a.lastName}`:"Not provided"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Email:"}),e.jsx("p",{className:"text-gray-900",children:a.email})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Phone:"}),e.jsx("p",{className:"text-gray-900",children:a.phone||"Not provided"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Wine Club:"}),e.jsx("p",{className:"text-gray-900",children:a.businessName})]})]}),e.jsx("div",{className:"mt-6",children:e.jsx(t,{variant:"secondary",size:"sm",className:"w-full",children:"Update Profile"})})]})]}),e.jsxs(l,{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-6",children:"Quick Actions"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(t,{variant:"secondary",className:"flex items-center justify-center",children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),"View Upcoming Deliveries"]}),e.jsxs(t,{variant:"secondary",className:"flex items-center justify-center",children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Rate Recent Wines"]}),e.jsxs(t,{variant:"secondary",className:"flex items-center justify-center",children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),"Manage Billing"]})]})]}),c&&e.jsxs(l,{className:"mt-8 p-6 bg-gray-50",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Need Help?"}),e.jsxs("p",{className:"text-gray-600 mb-4",children:["Have questions about your membership or wine selections? Contact ",c.name," directly."]}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-4",children:e.jsxs(t,{variant:"secondary",size:"sm",onClick:()=>window.location.href=`mailto:${c.email}`,children:["Email ",c.name]})})]})]})})]})};export{W as default};
//# sourceMappingURL=ScopedCustomerDashboard-BAnIT-Vo.js.map
