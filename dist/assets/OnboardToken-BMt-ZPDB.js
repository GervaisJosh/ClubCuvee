import{u as U,b as $,a as Y,r as n,c as b,s as B,j as e,C as o,A as j,B as C,d as L,e as R,f as W}from"./index-CgBscjZn.js";const O=()=>{const{token:i}=U(),[h]=$(),y=Y(),[d,S]=n.useState(null),[l,P]=n.useState([]),[a,N]=n.useState(""),[k,p]=n.useState(!0),[m,t]=n.useState(null),[f,x]=n.useState(!1),u=h.get("session_id"),v=h.get("success"),T=h.get("canceled");n.useEffect(()=>{if(!i){t("No invitation token provided"),p(!1);return}E()},[i]),n.useEffect(()=>{u&&v&&I()},[u,v]);const E=async()=>{try{p(!0),t(null);const s=await b.post("/api/validate-business-invitation",{token:i});if(!s.success||!s.data.is_valid){t("Invalid or expired business invitation token");return}S(s.data);const{data:r,error:_}=await B.from("business_pricing_tiers").select("id, name, description, monthly_price_cents, stripe_price_id").eq("is_active",!0).order("monthly_price_cents",{ascending:!0});if(_){console.error("Error loading pricing tiers:",_),t("Failed to load pricing options");return}const F=r?.map(c=>({id:c.id,name:c.name,description:c.description||`${c.name} subscription plan`,price_cents:c.monthly_price_cents,stripe_price_id:c.stripe_price_id}))||[];P(F)}catch(s){console.error("Error validating token and loading data:",s),t(s.message||"Failed to validate invitation")}finally{p(!1)}},I=async()=>{try{x(!0),(await b.post("/api/verify-business-subscription",{token:i,sessionId:u})).data.subscription.status==="active"?y(`/onboard/${i}/setup?session_id=${u}`):t("Payment verification failed. Please contact support.")}catch(s){console.error("Error verifying payment:",s),t("Payment verification failed. Please contact support.")}finally{x(!1)}},A=async()=>{if(!a){t("Please select a pricing tier");return}const s=l.find(r=>r.id===a);if(!s){t("Selected tier not found");return}if(!s.stripe_price_id){t("This tier is not available for online signup");return}try{x(!0),t(null),console.log("ðŸ” DEBUG - Frontend sending checkout data:",{token:i,tier_id:a,selectedTier:s});const r=await b.post("/api/create-business-checkout",{token:i,tier_id:a});r.success&&r.data.checkoutUrl?window.location.href=r.data.checkoutUrl:t("Failed to create checkout session")}catch(r){console.error("Error creating checkout session:",r),t(r.message||"Failed to start checkout process"),x(!1)}},w=s=>`$${(s/100).toFixed(0)}`;if(k)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-[#fdfaf7] px-6 py-10",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"h-12 w-12 animate-spin border-4 border-[#800020] border-t-transparent rounded-full mx-auto mb-6"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"Validating your invitation..."})]})});if(f)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-[#fdfaf7] px-6 py-10",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"h-12 w-12 animate-spin border-4 border-[#800020] border-t-transparent rounded-full mx-auto mb-6"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"Processing your payment..."})]})});if(T)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-[#fdfaf7] px-6 py-10",children:e.jsxs(o,{className:"max-w-md mx-auto p-8 text-center",children:[e.jsx(j,{className:"h-16 w-16 text-yellow-500 mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Payment Canceled"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Your payment was canceled. You can try again when you're ready."}),e.jsx(C,{onClick:()=>window.location.reload(),className:"w-full",children:"Try Again"})]})});if(m||!d)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-[#fdfaf7] px-6 py-10",children:e.jsxs(o,{className:"max-w-md mx-auto p-8 text-center",children:[e.jsx(j,{className:"h-16 w-16 text-red-500 mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Invalid Invitation"}),e.jsx("p",{className:"text-gray-600 mb-6",children:m||"This invitation link is invalid or has expired. Please request a new one."}),e.jsx(C,{onClick:()=>y("/landing"),variant:"secondary",className:"w-full",children:"Return Home"})]})});l.find(s=>s.id===a);const D=new Date(d.expires_at).getTime()-Date.now(),g=Math.floor(D/(1e3*60*60));return e.jsx("div",{className:"min-h-screen bg-[#fdfaf7] px-6 py-10",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-5xl font-bold bg-gradient-to-r from-[#800020] to-[#a00030] bg-clip-text text-transparent mb-4",children:"Welcome to Club CuvÃ©e"}),e.jsx("div",{className:"w-24 h-1 bg-gradient-to-r from-[#800020] to-[#a00030] mx-auto rounded-full"})]}),e.jsxs("p",{className:"text-2xl text-gray-700 mb-3",children:["Start your luxury wine club journey with ",e.jsx("strong",{className:"text-[#800020]",children:d.business_name})]}),e.jsx("p",{className:"text-gray-600 bg-gray-50 inline-block px-4 py-2 rounded-full",children:d.business_email})]}),g<24&&g>0&&e.jsx(o,{className:"p-4 mb-6 bg-yellow-50 border-yellow-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(L,{className:"h-5 w-5 text-yellow-500 mr-2"}),e.jsxs("p",{className:"text-sm text-yellow-700",children:["This invitation expires in ",g," hours. Complete your registration soon!"]})]})}),e.jsxs(o,{className:"p-8 mb-8 bg-gradient-to-br from-white to-gray-50 border-gray-200 shadow-xl",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-3",children:"Select Your Club CuvÃ©e Subscription"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"Choose the perfect plan to grow your wine business"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-8",children:l.map((s,r)=>e.jsx("div",{className:`group relative bg-white border-2 rounded-xl p-8 cursor-pointer transition-all duration-300 hover:scale-105 ${a===s.id?"border-[#800020] shadow-2xl shadow-[#800020]/20 bg-gradient-to-br from-[#800020]/5 to-white":"border-gray-200 hover:border-[#800020]/30 hover:shadow-xl"}`,onClick:()=>N(s.id),children:e.jsxs("div",{className:"text-center",children:[e.jsx("input",{type:"radio",name:"tier",value:s.id,checked:a===s.id,onChange:()=>N(s.id),className:"sr-only"}),r===1&&e.jsx("div",{className:"absolute -top-4 left-1/2 transform -translate-x-1/2",children:e.jsx("span",{className:"bg-gradient-to-r from-[#800020] to-[#a00030] text-white px-4 py-2 rounded-full text-sm font-semibold shadow-lg",children:"Most Popular"})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-3",children:s.name}),e.jsx("p",{className:"text-gray-600 text-sm leading-relaxed",children:s.description})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("div",{className:"text-4xl font-bold text-[#800020] mb-2",children:w(s.price_cents)}),e.jsx("div",{className:"text-gray-500 font-medium",children:"per month"})]}),a===s.id?e.jsxs("div",{className:"flex items-center justify-center space-x-2 text-[#800020]",children:[e.jsx(R,{className:"w-6 h-6"}),e.jsx("span",{className:"font-semibold",children:"Selected"})]}):e.jsxs("div",{className:"flex items-center justify-center space-x-2 text-gray-400 group-hover:text-[#800020] transition-colors",children:[e.jsx("div",{className:"w-6 h-6 border-2 border-current rounded-full"}),e.jsx("span",{className:"font-medium",children:"Select Plan"})]})]})},s.id))}),m&&e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg mb-6",children:e.jsxs("p",{className:"text-sm text-red-600 flex items-center",children:[e.jsx(j,{className:"w-5 h-5 mr-3"}),m]})}),e.jsx("div",{className:"text-center",children:a?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-[#800020]/5 border border-[#800020]/20 rounded-lg",children:[e.jsxs("p",{className:"text-sm text-gray-700 mb-2",children:[e.jsx("strong",{children:"Selected Plan:"})," ",l.find(s=>s.id===a)?.name]}),e.jsxs("p",{className:"text-2xl font-bold text-[#800020]",children:[w(l.find(s=>s.id===a)?.price_cents||0)," / month"]})]}),e.jsx("button",{onClick:A,disabled:f,className:"w-full bg-gradient-to-r from-[#800020] to-[#a00030] text-white font-semibold py-4 px-8 rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200 disabled:opacity-50 disabled:transform-none disabled:hover:shadow-lg",children:f?e.jsxs("div",{className:"flex items-center justify-center space-x-3",children:[e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"}),e.jsx("span",{children:"Starting Secure Checkout..."})]}):e.jsxs("div",{className:"flex items-center justify-center space-x-3",children:[e.jsx(W,{className:"w-5 h-5"}),e.jsx("span",{children:"Proceed to Secure Payment"})]})}),e.jsxs("p",{className:"text-xs text-gray-500 flex items-center justify-center space-x-2",children:[e.jsx("span",{children:"ðŸ”’ Secure payment processing by Stripe"}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:"Cancel anytime"})]})]}):e.jsx("div",{className:"p-4 bg-gray-50 border border-gray-200 rounded-lg",children:e.jsx("p",{className:"text-gray-600 text-center",children:"Please select a subscription plan to continue"})})})]}),e.jsxs(o,{className:"p-8 bg-gradient-to-r from-gray-50 to-gray-100 border-gray-200",children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-6 text-center",children:"Your Onboarding Journey"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-[#800020] to-[#a00030] text-white rounded-full flex items-center justify-center text-sm font-bold mr-4 mt-1",children:"1"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900 mb-1",children:"Secure Payment Processing"}),e.jsx("p",{className:"text-gray-600",children:"Complete your subscription payment through our secure Stripe integration"})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-[#800020] to-[#a00030] text-white rounded-full flex items-center justify-center text-sm font-bold mr-4 mt-1",children:"2"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900 mb-1",children:"Business Profile Setup"}),e.jsx("p",{className:"text-gray-600",children:"Create your account, set business details, and configure your wine club tiers"})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-[#800020] to-[#a00030] text-white rounded-full flex items-center justify-center text-sm font-bold mr-4 mt-1",children:"3"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900 mb-1",children:"Wine Inventory & AI Setup"}),e.jsx("p",{className:"text-gray-600",children:"Upload your wine inventory and let our AI create personalized recommendations"})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-r from-[#800020] to-[#a00030] text-white rounded-full flex items-center justify-center text-sm font-bold mr-4 mt-1",children:"4"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900 mb-1",children:"Launch Your Wine Club"}),e.jsx("p",{className:"text-gray-600",children:"Start accepting customer memberships and grow your recurring revenue"})]})]})]})]}),e.jsx("div",{className:"text-center mt-8 text-sm text-gray-500",children:e.jsxs("p",{children:["Need help? Contact our support team at"," ",e.jsx("a",{href:"mailto:support@clubcuvee.com",className:"text-[#800020] hover:underline",children:"support@clubcuvee.com"})]})})]})})};export{O as default};
//# sourceMappingURL=OnboardToken-BMt-ZPDB.js.map
