import{c as L,s as y,j as e,r as g,U as H,S as V,T as O,a as z,P as q,M as W,W as E,b as Y,G as Z,C as R,u as G,d as J,e as X,A as $,L as K}from"./index-z1fVrbjC.js";/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=L("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=L("CheckSquare",[["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}],["path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11",key:"1jnkn4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=L("GlassWater",[["path",{d:"M15.2 22H8.8a2 2 0 0 1-2-1.79L5 3h14l-1.81 17.21A2 2 0 0 1 15.2 22Z",key:"48rfw3"}],["path",{d:"M6 12a5 5 0 0 1 6 0 5 5 0 0 0 6 0",key:"mjntcy"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=L("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]),B={async createRestaurant(t){const{data:s,error:a}=await y.from("restaurants").insert([{name:t.restaurantName,website:t.website||"",admin_email:t.email,subscription_tier:t.tier||"basic",payment_session_id:t.sessionId||"",created_at:new Date().toISOString()}]).select().single();if(a)throw new Error(`Restaurant creation failed: ${a.message}`);return s},async uploadLogo(t,s){try{const a=s.name.split(".").pop(),l=`${t}/logo.${a}`,{error:u}=await y.storage.from("restaurant-logos").upload(l,s,{cacheControl:"3600",upsert:!0});if(u)throw u;const{data:r}=y.storage.from("restaurant-logos").getPublicUrl(l),{error:p}=await y.from("restaurants").update({logo_url:r.publicUrl}).eq("id",t);if(p)throw p;return r.publicUrl}catch(a){throw console.error("Logo upload error:",a),new Error("Failed to upload logo")}},async getRestaurantById(t){const{data:s,error:a}=await y.from("restaurants").select("*").eq("id",t).single();if(a)throw new Error(`Failed to fetch restaurant: ${a.message}`);if(!s)throw new Error("Restaurant not found");return s},async updateRestaurant(t,s){const{data:a,error:l}=await y.from("restaurants").update({...s,updated_at:new Date().toISOString()}).eq("id",t).select().single();if(l)throw new Error(`Failed to update restaurant: ${l.message}`);return a},async createInvitation(t,s,a,l,u="standard"){try{const{data:r}=await y.from("restaurant_invitations").select("token").eq("email",t).eq("status","pending").maybeSingle();if(r){const c=window.location.origin;return{token:r.token,invitationUrl:`${c}/onboarding/${r.token}`}}const p=crypto.randomUUID?crypto.randomUUID():Math.random().toString(36).substring(2),o=new Date;o.setDate(o.getDate()+7);const{data:d,error:w}=await y.from("restaurant_invitations").insert([{token:p,email:t,restaurant_name:s,website:a||"",admin_name:l||"",tier:u,created_at:new Date().toISOString(),expires_at:o.toISOString(),status:"pending"}]).select().single();if(w)throw new Error(`Failed to create invitation: ${w.message}`);const k=`${window.location.origin}/onboarding/${p}`;return{token:p,invitationUrl:k}}catch(r){throw console.error("Error creating invitation:",r),r}},async getInvitationByToken(t){try{const{data:s,error:a}=await y.from("restaurant_invitations").select("*").eq("token",t).single();if(a)return console.error("Error fetching invitation:",a),null;const l=new Date,u=new Date(s.expires_at);return l>u&&s.status==="pending"?(await y.from("restaurant_invitations").update({status:"expired"}).eq("id",s.id),{...s,status:"expired"}):s}catch(s){return console.error("Error checking invitation:",s),null}},async updateInvitationStatus(t,s,a){try{const l={status:s,updated_at:new Date().toISOString()};a&&(l.restaurant_id=a);const{error:u}=await y.from("restaurant_invitations").update(l).eq("token",t);if(u)throw new Error(`Failed to update invitation status: ${u.message}`)}catch(l){throw console.error("Error updating invitation status:",l),l}}},se={async createMembershipTier(t,s){try{if(t.stripe_product_id&&t.stripe_price_id){const{data:u,error:r}=await y.from("membership_tiers").insert([{name:t.name,price:t.price,description:t.description||"",restaurant_id:s,stripe_product_id:t.stripe_product_id,stripe_price_id:t.stripe_price_id,created_at:new Date().toISOString()}]).select().single();if(r)throw new Error(`Tier creation failed: ${r.message}`);return u}const a=await fetch("/api/membership-tiers",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t.name,price:t.price,description:t.description||"",restaurant_id:s})});if(!a.ok){const u=await a.json();throw new Error(u.error||"Failed to create membership tier")}return await a.json()}catch(a){throw console.error("Error creating membership tier:",a),a}},async updateMembershipTier(t){try{const s=await fetch("/api/membership-tiers",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok){const l=await s.json();throw new Error(l.error||"Failed to update membership tier")}return await s.json()}catch(s){throw console.error("Error updating membership tier:",s),s}},async getMembershipTiersByRestaurant(t){try{const{data:s,error:a}=await y.from("membership_tiers").select("*").eq("restaurant_id",t).order("price",{ascending:!0});if(a)throw new Error(`Failed to fetch tiers: ${a.message}`);return s||[]}catch(s){throw console.error("Error fetching membership tiers:",s),s}},async getMembershipTierById(t){try{const{data:s,error:a}=await y.from("membership_tiers").select("*").eq("id",t).single();if(a)throw new Error(`Failed to fetch tier: ${a.message}`);return s}catch(s){throw console.error("Error fetching membership tier:",s),s}}},A=({size:t="md",color:s="border-[#872657]",className:a=""})=>{const l={sm:"h-5 w-5 border-2",md:"h-8 w-8 border-2",lg:"h-12 w-12 border-3"}[t];return e.jsx("div",{className:`animate-spin rounded-full ${l} border-b-${s} ${a}`,role:"status","aria-label":"Loading"})},ae=({initialData:t,onSubmit:s,isSubmitting:a=!1,errors:l={},sessionId:u})=>{const[r,p]=g.useState(t),[o,d]=g.useState({});g.useEffect(()=>{p(t)},[t]),g.useEffect(()=>{d(l)},[l]);const w=x=>/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(x),f=x=>{const i=[];return x.length<8&&i.push("at least 8 characters"),/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]+/.test(x)||i.push("at least one special character"),/\d/.test(x)||i.push("at least one number"),/[A-Z]/.test(x)||i.push("at least one uppercase letter"),i},k=(x,i)=>{let h;switch(x){case"email":i&&!w(i)&&(h="Please enter a valid email address");break;case"password":if(i){const n=f(i);n.length>0&&(h=`Password must contain ${n.join(", ")}`)}break;case"confirmPassword":i!==r.password&&(h="Passwords do not match");break}return h},c=x=>{const{name:i,value:h}=x.target;p(v=>({...v,[i]:h})),o[i]&&d(v=>({...v,[i]:void 0}));const n=k(i,h);n&&d(v=>({...v,[i]:n}))},N=x=>{const i=x.target.files?.[0];if(!i)return;const h=["image/jpeg","image/png","image/webp"],n=5*1024*1024;if(!h.includes(i.type)){d({general:"Only JPG, PNG, and WEBP images are allowed"});return}if(i.size>n){d({general:"File size must be less than 5MB"});return}p({...r,logo:i})},_=x=>{x.preventDefault();let i=!0;const h={};if(r.restaurantName.trim()||(h.restaurantName="Restaurant name is required",i=!1),r.adminName.trim()||(h.adminName="Admin name is required",i=!1),r.email.trim()?w(r.email)||(h.email="Please enter a valid email address",i=!1):(h.email="Email is required",i=!1),!r.password)h.password="Password is required",i=!1;else{const n=f(r.password);n.length>0&&(h.password=`Password must contain ${n.join(", ")}`,i=!1)}r.password!==r.confirmPassword&&(h.confirmPassword="Passwords do not match",i=!1),d(h),i&&s({...r,sessionId:u})};return e.jsxs("form",{onSubmit:_,className:"space-y-8 md:space-y-10",children:[o.general&&e.jsx("div",{className:"p-4 bg-red-100 text-red-700 rounded-md border border-red-200",children:o.general}),e.jsxs("div",{className:"space-y-6 md:space-y-8",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Restaurant Name *"}),e.jsx("input",{type:"text",name:"restaurantName",value:r.restaurantName,onChange:c,required:!0,className:`w-full px-4 py-2 border ${o.restaurantName?"border-red-500":"border-gray-300"} rounded-md focus:ring-2 focus:ring-[#872657]`}),o.restaurantName&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:o.restaurantName})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Admin Name *"}),e.jsx("input",{type:"text",name:"adminName",value:r.adminName,onChange:c,required:!0,placeholder:"Your full name",className:`w-full px-4 py-2 border ${o.adminName?"border-red-500":"border-gray-300"} rounded-md focus:ring-2 focus:ring-[#872657]`}),o.adminName&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:o.adminName})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email *"}),e.jsx("input",{type:"email",name:"email",value:r.email,onChange:c,required:!0,placeholder:"admin@yourrestaurant.com",className:`w-full px-4 py-2 border ${o.email?"border-red-500":"border-gray-300"} rounded-md focus:ring-2 focus:ring-[#872657]`}),o.email&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:o.email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Website"}),e.jsx("input",{type:"url",name:"website",value:r.website||"",onChange:c,placeholder:"https://www.yourrestaurant.com",className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#872657]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Logo"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("label",{className:"cursor-pointer bg-[#2A3D45] text-white px-4 py-2 rounded-md hover:bg-opacity-90",children:[e.jsx(H,{className:"inline-block w-5 h-5 mr-2"}),"Upload Logo",e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:N})]}),r.logo&&e.jsxs("span",{className:"text-sm text-gray-600",children:["File selected: ",r.logo.name]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Password *"}),e.jsx("input",{type:"password",name:"password",value:r.password,onChange:c,required:!0,placeholder:"At least 8 characters",className:`w-full px-4 py-2 border ${o.password?"border-red-500":"border-gray-300"} rounded-md focus:ring-2 focus:ring-[#872657]`}),o.password&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:o.password})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Confirm Password *"}),e.jsx("input",{type:"password",name:"confirmPassword",value:r.confirmPassword,onChange:c,required:!0,placeholder:"Confirm your password",className:`w-full px-4 py-2 border ${o.confirmPassword?"border-red-500":"border-gray-300"} rounded-md focus:ring-2 focus:ring-[#872657]`}),o.confirmPassword&&e.jsx("p",{className:"mt-1 text-sm text-red-500",children:o.confirmPassword})]})]}),e.jsx("button",{type:"submit",disabled:a,className:`w-full md:w-auto md:px-12 mt-8 bg-[#872657] text-white py-4 rounded-md hover:bg-opacity-90 font-bold text-lg flex items-center justify-center ${a?"opacity-70 cursor-not-allowed":""}`,children:a?e.jsxs(e.Fragment,{children:[e.jsx(A,{size:"sm",className:"mr-2"}),"Processing..."]}):"Continue"})]})},M=[{icon:e.jsx(E,{className:"w-6 h-6"}),color:"#800020"},{icon:e.jsx(te,{className:"w-6 h-6"}),color:"#AA7F39"},{icon:e.jsx(Y,{className:"w-6 h-6"}),color:"#2F4858"},{icon:e.jsx(Z,{className:"w-6 h-6"}),color:"#5E2750"},{icon:e.jsx(ee,{className:"w-6 h-6"}),color:"#2A3D45"}],re=({tiers:t,restaurantId:s,onTierAdded:a,onTierUpdated:l,onTierDeleted:u,minTiersRequired:r=1,error:p})=>{const[o,d]=g.useState(!1),[w,f]=g.useState({id:"",name:"",price:"",description:""}),[k,c]=g.useState(!1),N=()=>{f({id:"",name:"",price:"",description:""}),c(!1),d(!0)},_=n=>{f(n),c(!0),d(!0)},x=n=>{k?l(n):a(n),d(!1)},i=n=>{t.length<=r?confirm(`You must have at least ${r} membership tier(s). Replace this tier with a new one?`)&&(f({id:"",name:"",price:"",description:""}),c(!1),d(!0)):confirm(`Are you sure you want to delete the "${n.name}" tier?`)&&u(n.id)},h=n=>n<M.length?M[n]:M[0];return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-[#800020]",style:{fontFamily:"HV Florentino"},children:"Membership Tiers"}),e.jsx("p",{className:"mb-6 text-gray-700",style:{fontFamily:"Libre Baskerville"},children:"Define 1-3 membership tiers that your guests can subscribe to. Each tier should have a unique name, price, and description of benefits."}),p&&e.jsx("div",{className:"p-4 bg-red-100 text-red-700 rounded-xl border border-red-200 mb-6",children:p}),t.length>0?e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:[t.map((n,v)=>{const j=h(v);return e.jsxs("div",{className:"bg-white rounded-xl shadow-md overflow-hidden border border-gray-100 hover:shadow-lg transition-all duration-300",style:{minHeight:"220px"},children:[e.jsxs("div",{className:"p-4 text-white flex justify-between items-center",style:{backgroundColor:j.color},children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-white bg-opacity-20 flex items-center justify-center mr-3",children:j.icon}),e.jsx("h3",{className:"font-bold text-xl",style:{fontFamily:"HV Florentino"},children:n.name})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{type:"button",onClick:()=>_(n),className:"p-1.5 bg-white bg-opacity-20 rounded-full hover:bg-opacity-30 transition-all duration-200","aria-label":`Edit ${n.name}`,children:e.jsx(V,{className:"w-4 h-4 text-white"})}),e.jsx("button",{type:"button",onClick:()=>i(n),className:"p-1.5 bg-white bg-opacity-20 rounded-full hover:bg-opacity-30 transition-all duration-200","aria-label":`Delete ${n.name}`,children:e.jsx(O,{className:"w-4 h-4 text-white"})})]})]}),e.jsx("div",{className:"px-4 py-3 bg-gray-50 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(z,{className:"w-4 h-4 text-gray-500 mr-2"}),e.jsxs("span",{className:"text-2xl font-bold text-gray-800",style:{fontFamily:"TayBasal"},children:["$",parseFloat(n.price).toFixed(2)]}),e.jsx("span",{className:"text-gray-500 ml-1",style:{fontFamily:"TayBasal"},children:"/month"})]})}),e.jsx("div",{className:"p-4",children:e.jsx("p",{className:"text-gray-700 text-sm",style:{fontFamily:"Libre Baskerville"},children:n.description||"No description provided."})})]},n.id)}),t.length<3&&e.jsxs("div",{onClick:N,className:"bg-white rounded-xl border-2 border-dashed border-gray-300 flex flex-col items-center justify-center p-6 cursor-pointer hover:border-[#800020] hover:bg-gray-50 transition-all duration-300",style:{minHeight:"220px"},children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-gray-100 flex items-center justify-center mb-4",children:e.jsx(q,{className:"w-8 h-8 text-gray-400"})}),e.jsx("p",{className:"text-gray-500 font-medium text-center",style:{fontFamily:"TayBasal"},children:"Add Another Tier"}),e.jsx("p",{className:"text-xs text-gray-400 text-center mt-1",style:{fontFamily:"Libre Baskerville"},children:t.length===0?"Add your first membership tier":"You can add up to 3 tiers"})]})]}):e.jsxs("div",{onClick:N,className:"bg-white rounded-xl border-2 border-dashed border-gray-300 flex flex-col items-center justify-center p-12 cursor-pointer hover:border-[#800020] hover:bg-gray-50 transition-all duration-300",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-gray-100 flex items-center justify-center mb-6",children:e.jsx(q,{className:"w-10 h-10 text-gray-400"})}),e.jsx("h3",{className:"text-xl font-medium text-gray-700 mb-2",style:{fontFamily:"HV Florentino"},children:"Create Your First Tier"}),e.jsx("p",{className:"text-gray-500 text-center max-w-md",style:{fontFamily:"Libre Baskerville"},children:"Define at least one membership tier with a name, price, and description"})]}),e.jsx(W,{isOpen:o,onClose:()=>d(!1),onSave:x,initialData:w,isEditing:k,restaurantId:s})]})},ie=({initialStep:t=1,initialRestaurantData:s={restaurantName:"",adminName:"",email:"",website:"",logo:null,password:"",confirmPassword:""},initialTiers:a=[],onComplete:l,isSubmitting:u=!1,sessionId:r,errors:p={},restaurantId:o})=>{const[d,w]=g.useState(t),[f,k]=g.useState(s),[c,N]=g.useState(a),_=b=>{k(b),w(2)},x=b=>{N([...c,b])},i=b=>{N(c.map(T=>T.id===b.id?b:T))},h=b=>{N(c.filter(T=>T.id!==b))},n=()=>{c.length!==0&&l({restaurant:f,tiers:c,restaurantId:o})},v=()=>e.jsx("div",{className:"mb-10",children:e.jsxs("div",{className:"flex items-center justify-between max-w-4xl mx-auto",children:[e.jsxs("div",{className:`flex flex-col items-center ${d>=1?"text-[#872657]":"text-gray-400"}`,children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center border-2 transition-all duration-300 ${d>=1?"border-[#872657] bg-[#872657] text-white":"border-gray-300 text-gray-400"}`,children:d>1?e.jsx(R,{className:"w-6 h-6"}):e.jsx(D,{className:"w-6 h-6"})}),e.jsx("span",{className:"mt-2 text-sm font-medium",style:{fontFamily:"TayBasal"},children:"Restaurant Info"})]}),e.jsx("div",{className:`flex-1 h-0.5 mx-4 transition-all duration-300 ${d>=2?"bg-[#872657]":"bg-gray-300"}`}),e.jsxs("div",{className:`flex flex-col items-center ${d>=2?"text-[#872657]":"text-gray-400"}`,children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center border-2 transition-all duration-300 ${d>=2?"border-[#872657] bg-[#872657] text-white":"border-gray-300 text-gray-400"}`,children:d>2?e.jsx(R,{className:"w-6 h-6"}):e.jsx(E,{className:"w-6 h-6"})}),e.jsx("span",{className:"mt-2 text-sm font-medium",style:{fontFamily:"TayBasal"},children:"Membership Tiers"})]}),e.jsx("div",{className:`flex-1 h-0.5 mx-4 transition-all duration-300 ${d>=3?"bg-[#872657]":"bg-gray-300"}`}),e.jsxs("div",{className:`flex flex-col items-center ${d>=3?"text-[#872657]":"text-gray-400"}`,children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center border-2 transition-all duration-300 ${d>=3?"border-[#872657] bg-[#872657] text-white":"border-gray-300 text-gray-400"}`,children:e.jsx(Q,{className:"w-6 h-6"})}),e.jsx("span",{className:"mt-2 text-sm font-medium",style:{fontFamily:"TayBasal"},children:"Review & Submit"})]})]})});let j;switch(d){case 1:j=e.jsxs("div",{className:"bg-white p-6 md:p-10 rounded-2xl shadow-lg border border-gray-200 transition-all duration-300 transform max-w-3xl md:max-w-4xl mx-auto",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6 text-[#872657]",style:{fontFamily:"HV Florentino"},children:"Restaurant Details"}),e.jsx(ae,{initialData:f,onSubmit:_,errors:p?.restaurant,sessionId:r})]});break;case 2:j=e.jsxs("div",{className:"bg-white p-6 md:p-10 rounded-2xl shadow-lg border border-gray-200 transition-all duration-300 transform max-w-3xl md:max-w-4xl mx-auto",children:[e.jsx(re,{tiers:c,restaurantId:o,onTierAdded:x,onTierUpdated:i,onTierDeleted:h,error:p?.tiers}),e.jsxs("div",{className:"mt-10 flex flex-col sm:flex-row gap-4 sm:gap-6",children:[e.jsx("button",{type:"button",onClick:()=>w(1),className:"flex-1 py-3 px-6 bg-gray-100 text-gray-800 rounded-xl hover:bg-gray-200 transition-colors duration-300",style:{fontFamily:"TayBasal"},children:"Back"}),e.jsx("button",{type:"button",onClick:()=>w(3),disabled:c.length===0,className:`flex-1 py-3 px-6 bg-[#800020] text-white rounded-xl hover:bg-opacity-90 font-bold transition-all duration-300 ${c.length===0?"opacity-50 cursor-not-allowed":""}`,style:{fontFamily:"TayBasal"},children:"Continue"})]})]});break;case 3:j=e.jsxs("div",{className:"bg-white p-6 md:p-10 rounded-2xl shadow-lg border border-gray-200 transition-all duration-300 transform max-w-3xl md:max-w-4xl mx-auto",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6 text-[#800020]",style:{fontFamily:"HV Florentino"},children:"Review Your Registration"}),p?.general&&e.jsx("div",{className:"mb-6 p-4 bg-red-100 text-red-700 rounded-xl border border-red-200",children:p.general}),e.jsxs("div",{className:"mb-12 space-y-10",children:[e.jsxs("div",{className:"bg-gray-50 rounded-xl p-6 md:p-8 shadow-sm border border-gray-100",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center text-[#800020]",style:{fontFamily:"HV Florentino"},children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-[#800020] text-white flex items-center justify-center mr-3 text-sm",children:e.jsx(D,{className:"w-4 h-4"})}),"Restaurant Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",style:{fontFamily:"TayBasal"},children:"Restaurant Name"}),e.jsx("p",{className:"font-medium",style:{fontFamily:"Libre Baskerville"},children:f.restaurantName})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",style:{fontFamily:"TayBasal"},children:"Admin Name"}),e.jsx("p",{className:"font-medium",style:{fontFamily:"Libre Baskerville"},children:f.adminName})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",style:{fontFamily:"TayBasal"},children:"Email"}),e.jsx("p",{className:"font-medium",style:{fontFamily:"Libre Baskerville"},children:f.email})]}),f.website&&e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",style:{fontFamily:"TayBasal"},children:"Website"}),e.jsx("p",{className:"font-medium",style:{fontFamily:"Libre Baskerville"},children:f.website})]}),f.logo&&e.jsxs("div",{className:"col-span-2 bg-white p-4 rounded-lg shadow-sm",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",style:{fontFamily:"TayBasal"},children:"Logo"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-md flex items-center justify-center mr-3",children:e.jsx("img",{src:URL.createObjectURL(f.logo),alt:"Logo Preview",className:"max-w-full max-h-full object-contain rounded-md"})}),e.jsx("p",{className:"font-medium",style:{fontFamily:"Libre Baskerville"},children:f.logo.name})]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-6 md:p-8 shadow-sm border border-gray-100",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center text-[#800020]",style:{fontFamily:"HV Florentino"},children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-[#800020] text-white flex items-center justify-center mr-3 text-sm",children:e.jsx(E,{className:"w-4 h-4"})}),"Membership Tiers"]}),c.length>0?e.jsx("div",{className:"space-y-4",children:c.map((b,T)=>e.jsx("div",{className:"p-5 bg-white rounded-xl shadow-sm border border-gray-100 hover:shadow-md transition-shadow duration-300",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-[#800020] text-lg",style:{fontFamily:"HV Florentino"},children:b.name}),e.jsxs("p",{className:"text-gray-800 font-bold text-xl mt-1",style:{fontFamily:"TayBasal"},children:["$",parseFloat(b.price).toFixed(2),"/month"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",style:{fontFamily:"Libre Baskerville"},children:b.description})]}),e.jsx("div",{className:"w-12 h-12 rounded-full bg-[#800020] bg-opacity-10 flex items-center justify-center",children:e.jsx(E,{className:"w-6 h-6 text-[#800020]"})})]})},b.id))}):e.jsx("p",{className:"text-red-500 p-4 bg-red-50 rounded-lg border border-red-100",style:{fontFamily:"Libre Baskerville"},children:"No membership tiers added. Please go back and add at least one tier."})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 sm:gap-6",children:[e.jsx("button",{type:"button",onClick:()=>w(2),className:"flex-1 py-3 px-6 bg-gray-100 text-gray-800 rounded-xl hover:bg-gray-200 transition-colors duration-300",style:{fontFamily:"TayBasal"},children:"Back"}),e.jsx("button",{type:"button",onClick:n,disabled:u||c.length===0,className:`flex-1 py-3 px-6 bg-[#800020] text-white rounded-xl hover:bg-opacity-90 font-bold transition-all duration-300 ${u||c.length===0?"opacity-70 cursor-not-allowed":""}`,style:{fontFamily:"TayBasal"},children:u?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(A,{size:"sm",className:"mr-2"}),"Processing..."]}):"Complete Registration"})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("p",{className:"text-xs text-gray-500",style:{fontFamily:"Libre Baskerville"},children:["By completing registration, you agree to Club Cuvee's ",e.jsx("a",{href:"/terms",className:"text-[#800020] hover:underline",children:"Terms of Service"})," and ",e.jsx("a",{href:"/privacy",className:"text-[#800020] hover:underline",children:"Privacy Policy"})]})})]});break;default:j=null}return e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-[#fdfaf7] dark:bg-black py-12 px-4 md:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-3xl md:max-w-4xl lg:max-w-5xl w-full mx-auto",children:[v(),e.jsx("div",{className:"transition-all duration-500 ease-in-out transform",children:j})]})})},oe=()=>{const{restaurantRef:t}=G(),s=J(),a=X(),l=new URLSearchParams(a.search),u=l.get("session_id"),r=l.get("status"),[p,o]=g.useState(!0),[d,w]=g.useState(!1),[f,k]=g.useState(1),[c,N]=g.useState(!1),[_,x]=g.useState({}),[i,h]=g.useState({restaurantName:"",adminName:"",email:"",website:"",logo:null,password:"",confirmPassword:""}),[n,v]=g.useState([]),[j,b]=g.useState(""),[T,I]=g.useState(!0);g.useEffect(()=>{(async()=>{try{if(o(!0),u&&r==="success"&&I(!0),t){const m=await B.getInvitationByToken(t);if(m){if(m.status==="expired"){x({general:"This invitation link has expired. Please request a new invitation."}),o(!1);return}if(h({restaurantName:m.restaurant_name,adminName:m.admin_name||"",email:m.email,website:m.website||"",password:"",confirmPassword:"",tier:m.tier,invitationToken:m.token}),(m.status==="paid"||m.payment_session_id)&&I(!0),m.restaurant_id){b(m.restaurant_id),k(2);try{const{data:F,error:P}=await y.from("membership_tiers").select("*").eq("restaurant_id",m.restaurant_id);!P&&F&&F.length>0&&v(F)}catch(F){console.error("Error fetching existing tiers:",F)}}m.status==="pending"&&await B.updateInvitationStatus(m.token,"accepted")}else x({general:"Invalid invitation token. Please check your invitation email or contact support."})}else x({general:"No invitation token provided. Please use the link from your invitation email."})}catch(m){console.error("Error checking registration status:",m),x({general:"Error loading registration data. Please try again or contact support."})}finally{o(!1)}})()},[t,u,r]);const U=async C=>{N(!0),x({});try{const m=C.restaurantId||j;if(!m)throw new Error("Missing restaurant ID");const F=C.tiers.map(async S=>S.id&&S.stripe_product_id&&S.stripe_price_id&&S.restaurant_id===m?S:await se.createMembershipTier({name:S.name,price:S.price,description:S.description,stripe_product_id:S.stripe_product_id,stripe_price_id:S.stripe_price_id},m));await Promise.all(F),await B.updateRestaurant(m,{registration_complete:!0,updated_at:new Date().toISOString()}),i.invitationToken&&await B.updateInvitationStatus(i.invitationToken,"completed",m);const{error:P}=await y.auth.signUp({email:C.restaurant.email,password:C.restaurant.password,options:{data:{restaurant_id:m,full_name:C.restaurant.adminName,role:"restaurant_admin"}}});P&&console.error("Error creating user account:",P),w(!0)}catch(m){console.error("Error completing registration:",m),x({general:m.message||"Failed to complete registration"})}finally{N(!1)}};return p?e.jsx($,{children:e.jsx("div",{className:"min-h-screen flex items-center justify-center py-16 px-4 md:px-6 lg:px-8",children:e.jsxs("div",{className:"text-center max-w-lg mx-auto",children:[e.jsx(K,{className:"h-12 w-12 animate-spin text-[#872657] mx-auto mb-6"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"Loading your restaurant registration..."})]})})}):d?e.jsx($,{children:e.jsx("div",{className:"min-h-screen flex items-center justify-center py-16 px-4 md:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-xl w-full p-8 md:p-10 bg-white rounded-xl shadow-lg text-center",children:[e.jsx("div",{className:"mb-6 p-4 bg-green-100 rounded-full inline-flex items-center justify-center",children:e.jsx(R,{className:"w-16 h-16 text-green-500"})}),e.jsx("h1",{className:"text-3xl font-bold mb-4 text-[#872657]",children:"You're All Set!"}),e.jsx("p",{className:"mb-8 text-gray-700",children:"Your restaurant has been registered with Club Cuvee and your membership tiers are ready. You can now access your dashboard to manage your wine club."}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-center space-y-3 sm:space-y-0 sm:space-x-4",children:[e.jsx("button",{onClick:()=>s("/dashboard"),className:"w-full sm:w-auto sm:px-8 bg-[#872657] text-white py-3 rounded-md hover:bg-opacity-90 font-bold",children:"Go to Dashboard"}),e.jsx("button",{onClick:()=>s("/preview-wine-club"),className:"w-full sm:w-auto sm:px-8 bg-white border border-[#872657] text-[#872657] py-3 rounded-md hover:bg-gray-50 font-bold",children:"Preview Your Wine Club"})]})]})})}):_.general&&!j?e.jsx($,{children:e.jsx("div",{className:"min-h-screen flex items-center justify-center py-16 px-4 md:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-xl w-full p-8 md:p-10 bg-white rounded-xl shadow-lg text-center",children:[e.jsx("div",{className:"mb-6 p-4 bg-red-100 rounded-full inline-flex items-center justify-center",children:e.jsx(E,{className:"w-16 h-16 text-red-500"})}),e.jsx("h1",{className:"text-3xl font-bold mb-4 text-[#872657]",children:"Invitation Error"}),e.jsx("p",{className:"mb-4 text-gray-700",children:_.general}),e.jsx("p",{className:"text-sm text-gray-500 mb-8",children:"Please check your email for a valid invitation or contact support for assistance."}),e.jsx("button",{onClick:()=>window.location.href="https://clubcuvee.com/contact",className:"w-full sm:w-auto sm:px-8 bg-[#872657] text-white py-3 rounded-md hover:bg-opacity-90 font-bold mx-auto",children:"Contact Support"})]})})}):e.jsx($,{children:e.jsx("div",{className:"min-h-screen bg-gray-50 py-16 px-4 md:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-12 md:mb-16",children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-[#872657] mb-4",children:"Welcome to Club Cuvee"}),e.jsx("p",{className:"text-xl text-gray-600 max-w-3xl mx-auto px-4",children:"Set up your custom wine club and start offering personalized wine memberships to your guests"})]}),e.jsx(ie,{initialStep:f,initialRestaurantData:i,initialTiers:n,onComplete:U,isSubmitting:c,sessionId:u||void 0,errors:_,restaurantId:j})]})})})};export{oe as default};
//# sourceMappingURL=_restaurantRef_-s1NSKGi8.js.map
