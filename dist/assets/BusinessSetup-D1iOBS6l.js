import{u as M,b as A,a as F,r as m,c as b,j as e,C as h,B as p,e as T,P as D,T as B}from"./index-DJH-YA4b.js";const _=()=>{const{token:n}=M(),[w]=A(),g=F(),c=w.get("session_id"),[a,o]=m.useState({businessName:"",adminName:"",adminEmail:"",adminPassword:"",confirmPassword:"",tiers:[{name:"Silver",description:"Entry level wine club membership",priceMarkupPercentage:15},{name:"Gold",description:"Premium wine club membership",priceMarkupPercentage:25},{name:"Platinum",description:"Exclusive wine club membership",priceMarkupPercentage:35}]}),[y,N]=m.useState(!1),[u,t]=m.useState(null),[v,x]=m.useState(!0);m.useEffect(()=>{if(!n||!c){t("Missing required parameters"),x(!1);return}P()},[n,c]);const P=async()=>{try{x(!0);const s=await b.post("/api/verify-business-subscription",{token:n,sessionId:c});if(s.success&&s.data.subscription.status==="active"){const r=await b.post("/api/validate-business-invitation",{token:n});r.success&&o(i=>({...i,businessName:r.data.business_name,adminEmail:r.data.business_email}))}else t("Payment verification failed. Please contact support.")}catch(s){console.error("Error verifying payment:",s),t("Payment verification failed. Please contact support.")}finally{x(!1)}},d=s=>{const{name:r,value:i}=s.target;o(l=>({...l,[r]:i})),t(null)},f=(s,r,i)=>{o(l=>({...l,tiers:l.tiers.map((j,S)=>S===s?{...j,[r]:i}:j)}))},k=()=>{o(s=>({...s,tiers:[...s.tiers,{name:"",description:"",priceMarkupPercentage:20}]}))},C=s=>{a.tiers.length>1&&o(r=>({...r,tiers:r.tiers.filter((i,l)=>l!==s)}))},E=()=>{if(!a.businessName.trim())return t("Business name is required"),!1;if(!a.adminName.trim())return t("Admin name is required"),!1;if(!a.adminEmail.trim())return t("Admin email is required"),!1;if(!a.adminPassword)return t("Admin password is required"),!1;if(a.adminPassword!==a.confirmPassword)return t("Passwords do not match"),!1;if(a.adminPassword.length<8)return t("Password must be at least 8 characters long"),!1;if(a.tiers.length===0)return t("At least one membership tier is required"),!1;for(const s of a.tiers){if(!s.name.trim())return t("All tiers must have a name"),!1;if(!s.description.trim())return t("All tiers must have a description"),!1;if(s.priceMarkupPercentage<0||s.priceMarkupPercentage>100)return t("Price markup percentage must be between 0 and 100"),!1}return!0},q=async s=>{if(s.preventDefault(),!!E()){N(!0),t(null);try{(await b.post("/api/create-business",{token:n,sessionId:c,businessData:a})).success?g(`/onboard/${n}/success`):t("Failed to create business. Please try again.")}catch(r){console.error("Error creating business:",r),t(r.message||"Failed to create business. Please try again.")}finally{N(!1)}}};return v?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-[#fdfaf7] px-6 py-10",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"h-12 w-12 animate-spin border-4 border-[#800020] border-t-transparent rounded-full mx-auto mb-6"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"Verifying your payment..."})]})}):u&&!a.adminEmail?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-[#fdfaf7] px-6 py-10",children:e.jsxs(h,{className:"max-w-md mx-auto p-8 text-center",children:[e.jsx("div",{className:"text-red-500 mb-4",children:"âŒ"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Setup Error"}),e.jsx("p",{className:"text-gray-600 mb-6",children:u}),e.jsx(p,{onClick:()=>g("/landing"),variant:"secondary",className:"w-full",children:"Return Home"})]})}):e.jsx("div",{className:"min-h-screen bg-[#fdfaf7] px-6 py-10",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx(T,{className:"h-16 w-16 text-green-500 mx-auto mb-4"}),e.jsx("h1",{className:"text-4xl font-bold text-gray-900 mb-2",children:"Payment Successful!"}),e.jsx("p",{className:"text-xl text-gray-600",children:"Now let's set up your business and wine club tiers"})]}),e.jsxs("form",{onSubmit:q,className:"space-y-8",children:[e.jsxs(h,{className:"p-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Business Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"businessName",className:"block text-sm font-medium text-gray-700 mb-2",children:"Business Name *"}),e.jsx("input",{type:"text",id:"businessName",name:"businessName",value:a.businessName,onChange:d,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-[#800020] focus:border-transparent",placeholder:"Your Restaurant or Wine Shop"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"adminName",className:"block text-sm font-medium text-gray-700 mb-2",children:"Administrator Name *"}),e.jsx("input",{type:"text",id:"adminName",name:"adminName",value:a.adminName,onChange:d,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-[#800020] focus:border-transparent",placeholder:"John Doe"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"adminEmail",className:"block text-sm font-medium text-gray-700 mb-2",children:"Administrator Email *"}),e.jsx("input",{type:"email",id:"adminEmail",name:"adminEmail",value:a.adminEmail,onChange:d,required:!0,disabled:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm bg-gray-50 text-gray-500"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"This email was used for your subscription"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"adminPassword",className:"block text-sm font-medium text-gray-700 mb-2",children:"Administrator Password *"}),e.jsx("input",{type:"password",id:"adminPassword",name:"adminPassword",value:a.adminPassword,onChange:d,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-[#800020] focus:border-transparent",placeholder:"Minimum 8 characters"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 mb-2",children:"Confirm Password *"}),e.jsx("input",{type:"password",id:"confirmPassword",name:"confirmPassword",value:a.confirmPassword,onChange:d,required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-[#800020] focus:border-transparent",placeholder:"Confirm your password"})]})]})]}),e.jsxs(h,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Wine Club Membership Tiers"}),e.jsxs(p,{type:"button",onClick:k,variant:"secondary",size:"sm",children:[e.jsx(D,{className:"w-4 h-4 mr-2"}),"Add Tier"]})]}),e.jsx("div",{className:"space-y-4",children:a.tiers.map((s,r)=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:["Tier ",r+1]}),a.tiers.length>1&&e.jsx(p,{type:"button",onClick:()=>C(r),variant:"secondary",size:"sm",children:e.jsx(B,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tier Name *"}),e.jsx("input",{type:"text",value:s.name,onChange:i=>f(r,"name",i.target.value),required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-[#800020] focus:border-transparent",placeholder:"e.g., Silver, Gold, Platinum"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Price Markup (%) *"}),e.jsx("input",{type:"number",min:"0",max:"100",value:s.priceMarkupPercentage,onChange:i=>f(r,"priceMarkupPercentage",parseFloat(i.target.value)||0),required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-[#800020] focus:border-transparent",placeholder:"20"})]}),e.jsxs("div",{className:"md:col-span-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description *"}),e.jsx("textarea",{value:s.description,onChange:i=>f(r,"description",i.target.value),required:!0,rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-[#800020] focus:border-transparent",placeholder:"Describe this membership tier"})]})]})]},r))}),e.jsx("div",{className:"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-md",children:e.jsxs("p",{className:"text-sm text-blue-700",children:[e.jsx("strong",{children:"Price Markup:"})," This percentage will be added to your wine inventory base prices for this tier. For example, a wine with a base price of $20 and 25% markup will be offered to customers at $25."]})})]}),u&&e.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-md",children:e.jsx("p",{className:"text-sm text-red-600",children:u})}),e.jsx("div",{className:"text-center",children:e.jsx(p,{type:"submit",disabled:y,className:"px-8 py-3",children:y?"Creating Your Business...":"Complete Setup"})})]})]})})};export{_ as default};
//# sourceMappingURL=BusinessSetup-D1iOBS6l.js.map
