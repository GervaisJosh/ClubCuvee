import{u as $,b as R,a as Y,r as i,c as y,s as B,j as e,C as l,A as b,B as j,d as L,S as W,e as q,f as H}from"./index-DJH-YA4b.js";const V=()=>{const{token:n}=$(),[m]=R(),v=Y(),[c,k]=i.useState(null),[u,P]=i.useState([]),[r,h]=i.useState(""),[S,p]=i.useState(!0),[o,t]=i.useState(null),[f,d]=i.useState(!1),x=m.get("session_id"),N=m.get("success"),_=m.get("canceled");i.useEffect(()=>{if(!n){t("No invitation token provided"),p(!1);return}T()},[n]),i.useEffect(()=>{x&&N&&E()},[x,N]);const T=async()=>{try{p(!0),t(null);const s=await y.post("/api/validate-business-invitation",{token:n});if(!s.success||!s.data.is_valid){t("Invalid or expired business invitation token");return}k(s.data);const{data:a,error:w}=await B.rpc("get_active_business_pricing_tiers");if(w){console.error("Error loading pricing tiers:",w),t("Failed to load pricing options");return}if(P(a||[]),s.data.pricing_tier&&a){const C=a.find(U=>U.id===s.data.pricing_tier);C&&h(C.id)}}catch(s){console.error("Error validating token and loading data:",s),t(s.message||"Failed to validate invitation")}finally{p(!1)}},E=async()=>{try{d(!0),(await y.post("/api/verify-business-subscription",{token:n,sessionId:x})).data.subscription.status==="active"?v(`/onboard/${n}/setup?session_id=${x}`):t("Payment verification failed. Please contact support.")}catch(s){console.error("Error verifying payment:",s),t("Payment verification failed. Please contact support.")}finally{d(!1)}},I=async()=>{if(!r){t("Please select a pricing tier");return}const s=u.find(a=>a.id===r);if(!s){t("Selected tier not found");return}if(!s.stripe_price_id){t("This tier is not available for online signup");return}try{d(!0),t(null);const a=await y.post("/api/create-business-checkout",{token:n,tier_id:r});a.success&&a.data.checkoutUrl?window.location.href=a.data.checkoutUrl:t("Failed to create checkout session")}catch(a){console.error("Error creating checkout session:",a),t(a.message||"Failed to start checkout process"),d(!1)}},A=s=>`$${(s/100).toFixed(0)}`;if(S)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-[#fdfaf7] px-6 py-10",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"h-12 w-12 animate-spin border-4 border-[#800020] border-t-transparent rounded-full mx-auto mb-6"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"Validating your invitation..."})]})});if(f)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-[#fdfaf7] px-6 py-10",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"h-12 w-12 animate-spin border-4 border-[#800020] border-t-transparent rounded-full mx-auto mb-6"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"Processing your payment..."})]})});if(_)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-[#fdfaf7] px-6 py-10",children:e.jsxs(l,{className:"max-w-md mx-auto p-8 text-center",children:[e.jsx(b,{className:"h-16 w-16 text-yellow-500 mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Payment Canceled"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Your payment was canceled. You can try again when you're ready."}),e.jsx(j,{onClick:()=>window.location.reload(),className:"w-full",children:"Try Again"})]})});if(o||!c)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-[#fdfaf7] px-6 py-10",children:e.jsxs(l,{className:"max-w-md mx-auto p-8 text-center",children:[e.jsx(b,{className:"h-16 w-16 text-red-500 mx-auto mb-4"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Invalid Invitation"}),e.jsx("p",{className:"text-gray-600 mb-6",children:o||"This invitation link is invalid or has expired. Please request a new one."}),e.jsx(j,{onClick:()=>v("/landing"),variant:"secondary",className:"w-full",children:"Return Home"})]})});const D=u.find(s=>s.id===r),F=new Date(c.expires_at).getTime()-Date.now(),g=Math.floor(F/(1e3*60*60));return e.jsx("div",{className:"min-h-screen bg-[#fdfaf7] px-6 py-10",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-4xl font-bold text-gray-900 mb-4",children:"Welcome to Club Cuvée"}),e.jsxs("p",{className:"text-xl text-gray-600 mb-2",children:["Complete your business registration for ",e.jsx("strong",{children:c.business_name})]}),e.jsxs("p",{className:"text-gray-500",children:["Invitation sent to: ",c.business_email]})]}),g<24&&g>0&&e.jsx(l,{className:"p-4 mb-6 bg-yellow-50 border-yellow-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(L,{className:"h-5 w-5 text-yellow-500 mr-2"}),e.jsxs("p",{className:"text-sm text-yellow-700",children:["This invitation expires in ",g," hours. Complete your registration soon!"]})]})}),e.jsxs(l,{className:"p-8 mb-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-6 text-center",children:"Choose Your Club Cuvée Plan"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:u.map(s=>e.jsx("div",{className:`border rounded-lg p-6 cursor-pointer transition-all relative ${r===s.id?"border-[#800020] bg-[#800020]/5 shadow-lg":"border-gray-200 hover:border-gray-300 hover:shadow-md"}`,onClick:()=>h(s.id),children:e.jsxs("div",{className:"text-center",children:[e.jsx("input",{type:"radio",name:"tier",value:s.id,checked:r===s.id,onChange:()=>h(s.id),className:"sr-only"}),c.pricing_tier&&s.id===c.pricing_tier&&e.jsx("div",{className:"absolute -top-3 left-1/2 transform -translate-x-1/2",children:e.jsxs("span",{className:"bg-[#800020] text-white px-3 py-1 rounded-full text-xs font-medium flex items-center",children:[e.jsx(W,{className:"w-3 h-3 mr-1"}),"Suggested"]})}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:s.name}),e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-3xl font-bold text-[#800020]",children:A(s.price_cents)}),e.jsx("div",{className:"text-sm text-gray-500",children:"per month"})]}),r===s.id&&e.jsx(q,{className:"w-6 h-6 text-[#800020] mx-auto"})]})},s.id))}),o&&e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-md mb-6",children:e.jsxs("p",{className:"text-sm text-red-600 flex items-center",children:[e.jsx(b,{className:"w-4 h-4 mr-2"}),o]})}),e.jsx("div",{className:"text-center",children:e.jsxs(j,{onClick:I,disabled:!r||f,className:"px-8 py-3",children:[e.jsx(H,{className:"w-5 h-5 mr-2"}),f?"Starting Checkout...":"Proceed to Payment"]})}),D&&e.jsx("p",{className:"text-xs text-gray-500 text-center mt-4",children:"Secure payment processing by Stripe • Cancel anytime"})]}),e.jsxs(l,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"What happens next?"}),e.jsxs("div",{className:"space-y-3 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"w-6 h-6 bg-[#800020] text-white rounded-full flex items-center justify-center text-xs mr-3 mt-0.5",children:"1"}),e.jsx("p",{children:"Complete your subscription payment via Stripe"})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"w-6 h-6 bg-[#800020] text-white rounded-full flex items-center justify-center text-xs mr-3 mt-0.5",children:"2"}),e.jsx("p",{children:"Set up your business profile and wine club tiers"})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"w-6 h-6 bg-[#800020] text-white rounded-full flex items-center justify-center text-xs mr-3 mt-0.5",children:"3"}),e.jsx("p",{children:"Upload your wine inventory and configure recommendations"})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"w-6 h-6 bg-[#800020] text-white rounded-full flex items-center justify-center text-xs mr-3 mt-0.5",children:"4"}),e.jsx("p",{children:"Start accepting customer memberships immediately"})]})]})]}),e.jsx("div",{className:"text-center mt-8 text-sm text-gray-500",children:e.jsxs("p",{children:["Need help? Contact our support team at"," ",e.jsx("a",{href:"mailto:support@clubcuvee.com",className:"text-[#800020] hover:underline",children:"support@clubcuvee.com"})]})})]})})};export{V as default};
//# sourceMappingURL=OnboardToken-CTUGkLp0.js.map
